---
title: 零后端开发实战：用 Supabase 快速搭建你的 App
date: 2025-05-21
author: koocyton
catalog: flutter
tags:
- supabase
- flutter
header-img: /img/larsonist.jpg
---

### 前言

我一直在思考两个问题

1. 在移动平台上的文本编辑器为啥都很难用，
   即使是平台上的记事本，也是难用的不行，
   我很难适应在文档编辑的窗口上，会自带一个删除文档的按钮，
   还有编辑的菜单在切换时，上下的跳，
   以及不把编辑功能集中在一个面板上，需要多个 lable 来切换，
   这些点上，苹果自带的编辑器真的很棒

2. 我们已经有各种云服务了，我想
   我最好不要自己来建立服务端，我希望app自己就能将客户端的
   数据存储在云端上，而且能做好用户数据的隔离，用户仅有权限
   看到自己的数据。如果是自己搭建服务器来支持，这就简单，如果
   是云服务来，该怎么支持呢 。

按这个思路，开始自己写一个记事本的 APP，断断续续一年，最近我
做了大量重写。完善这些功能，并添加了 AI 助手到 APP 里，
目前已经发布在 google play,我想可以分享开发要点。首先可以
介绍如何来完成无服务端的数据存储。

我选择了 Supabase 作为整个应用的后端替代方案。Supabase 提供了 Auth（身份认证）、Storage（对象存储）、Database（PostgreSQL）等一整套服务，最关键的是，它允许我们在无需自己维护服务器的前提下，也能实现细粒度的用户权限管理。在这些功能上他比 firebaes
更好用。

在这个笔记应用中，我只使用了 Supabase Auth + Storage 两项服务，就实现了用户数据上传、下载和隔离的全部功能。

开发流程概览：

   1. 用户注册与登录（Supabase Auth）
   2. 用户身份隔离机制（通过 UID 生成目录）
   3. 客户端数据加密（文本和图片 AES 加密）
   4. 上传数据到 Supabase Storage
   5. 下载数据时客户端解密
   6. 权限规则配置确保用户只能访问自己的数据

一、用户身份认证与 UID 管理
使用 Supabase Auth，可以快速集成邮箱登录、OAuth、匿名登录等方式。
这里就不多讲述了，只是在通过 Google 账号登录有两点需要注意和 Firebase auth不一样
   1. 需要注册一个 web 应用，拿到配置项的ID，firebase auth ,是一个 android 应用
   2. 登陆是需要将 serviceClientId 填写，才能拿到 accessToken 和 idToken 都拿到

登录成功后，Supabase 会返回一个唯一的 user.id（也就是 UID），这个 UID 是我们后续所有用户数据隔离和加密操作的基础。

二、安全设计：用 UID 创建 AES 密钥与专属目录
为了实现数据隔离和加密，我设计了以下策略：

1. 用 UID 派生用户存储目录
每个用户登录后，我将其 UID 取 MD5 哈希值后，作为其存储目录名。例如：

bash
复制
编辑
/notes/<md5(uid)>/xxxx.txt
/notes/<md5(uid)>/images/xxx.png
这样做有两个好处：

防止直接暴露用户 UID（增强安全性）

每个用户天然拥有独立目录，便于权限隔离

2. 生成 AES 密钥用于客户端加密
我用以下方式生成对称加密的密钥：

dart
复制
编辑
final aesKey = sha256.convert(utf8.encode(uid)).bytes;
使用这个 Key，我可以在客户端使用 AES 算法加密用户的笔记内容（富文本 JSON）以及插入的图片。

三、加密上传流程
在用户保存笔记时，我的做法如下：

将富文本内容（JSON）通过 AES 加密

将本地图片压缩后加密

将这些加密后的内容作为字节流上传到 Supabase Storage 对应的路径

上传 API 使用 Supabase 提供的客户端 SDK，直接将加密后的内容上传为 blob 文件。

四、解密与展示
从 Supabase Storage 下载数据时：

读取文件内容到字节流

使用用户 UID 生成相同的 AES 密钥

解密字节流，还原为原始文本或图片

加载回富文本编辑器中展示

整个过程没有任何后端参与，也没有将用户的密钥或明文数据上传到云端。

五、权限配置（Supabase RLS）
为了确保安全，我在 Supabase 的 Storage 设置中配置了 访问规则（Policies）：

用户只能访问路径包含其 UID 哈希值的目录

禁止列出所有目录（防止信息泄露）

必须处于认证状态才能上传或下载

Supabase 的权限规则是基于 PostgreSQL Row Level Security（RLS）实现的，配置起来也相对直观。

总结：为什么这样设计？
安全性：所有数据均在客户端加密，Supabase 只是“文件中转站”

用户隔离：通过 UID 哈希和权限策略，用户无法访问他人数据

开发效率高：没有后端代码，全部逻辑集中在客户端

功能完整：支持登录、加密存储、图文混排、跨设备同步等功能

我会在后续更新中继续完善 AI 助手和 PDF 导出等功能，也会逐步开源核心逻辑代码，如果你也想开发一款真正意义上“无服务端”的 App，Supabase 是一个非常值得一试的方案。