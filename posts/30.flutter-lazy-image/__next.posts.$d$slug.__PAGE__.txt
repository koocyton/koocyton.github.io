1:"$Sreact.fragment"
2:I[22016,["/_next/static/chunks/7c92e96509cd355e.js","/_next/static/chunks/011498a708c7513f.js"],""]
4:I[31175,["/_next/static/chunks/7c92e96509cd355e.js","/_next/static/chunks/011498a708c7513f.js"],"default"]
5:I[97367,["/_next/static/chunks/ff1a16fafef87110.js","/_next/static/chunks/d2be314c3ece3fbe.js"],"OutletBoundary"]
6:"$Sreact.suspense"
3:T680,<h2>说个漫画类 APP 加载</h2>
<p>flutter listview 因为要释放屏幕外的图片，</p>
<p>那么会状态刷新时，前面的图片高度会变成 0</p>
<p>使得滚动乱跳。那么可以用 Sizedbox 将图片框起来</p>
<p>当图片加载后，计算图片的高度，将这个高度赋值给 sizedbox</p>
<p>这样 List 里的 每个元素高度就被固定了，滚动起来不会乱跳</p>
<p>用 customscroll 应该更合适些，因为每个元素的高度不一致</p>
<h2>代码</h2>
<pre><code class="hljs language-dart">ListView.builder(
  itemCount: controller.chapterImagesRx.length,
  padding: EdgeInsets.all(0),
  controller: controller.scrollController,
  itemBuilder: (c, o){
    String imageUrl = controller.chapterImagesRx[o];
    imageUrl = imageUrl.startsWith("//") ? "https:$imageUrl" : imageUrl;

    // image
    final Image image = Image.network(
      imageUrl,
      fit: BoxFit.contain
    );

    // stream
    final ImageStream stream = image.image.resolve(ImageConfiguration.empty);

    // listener
    stream.addListener(
      // 加载完图片，拿到图片的高度，赋值给图片的容器
      ImageStreamListener((ImageInfo info, bool _) {
        final uii.Image image = info.image;
        final imageWidth = image.width.toDouble();
        final imageHeight = image.height.toDouble();
        // 注意在这里设置高度
        controller.chapterImagesHeightRx[o] = ui.windowWidth * (imageHeight/imageWidth);
      }),
    );
    // 图片的容器
    return SizedBox(
      // 在这里使用高度
      height: controller.chapterImagesHeightRx[o],
      child: image,
    );
  }
);
</code></pre>0:{"buildId":"EVtZz7NMWEkTZ7ALHwGzd","rsc":["$","$1","c",{"children":[["$","article",null,{"className":"max-w-2xl mx-auto px-5 py-10","children":[["$","header",null,{"className":"mb-8","children":[["$","h1",null,{"className":"font-mono text-xl font-semibold text-[var(--color-text)] leading-tight","children":"Flutter lazy image"}],["$","div",null,{"className":"flex items-center gap-3 mt-2 text-xs text-[var(--color-text-tertiary)] font-mono","children":[["$","time",null,{"dateTime":"2025-06-10","children":"2025-06-10"}],["$","span",null,{"children":"·"}],["$","span",null,{"children":"2 min read"}]]}],["$","div",null,{"className":"flex flex-wrap gap-1.5 mt-3","children":[["$","$L2","lazy",{"href":"/tags/lazy","className":"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors","children":["#","lazy"]}],["$","$L2","image",{"href":"/tags/image","className":"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors","children":["#","image"]}],["$","$L2","input",{"href":"/tags/input","className":"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors","children":["#","input"]}]]}]]}],["$","div",null,{"className":"prose","dangerouslySetInnerHTML":{"__html":"$3"}}],["$","$L4",null,{}],["$","footer",null,{"className":"mt-8 pt-4 border-t border-[var(--color-border)]","children":["$","$L2",null,{"href":"/","className":"text-sm text-[var(--color-link)] hover:underline","children":"← 返回"}]}]]}],[["$","script","script-0",{"src":"/_next/static/chunks/011498a708c7513f.js","async":true}]],["$","$L5",null,{"children":["$","$6",null,{"name":"Next.MetadataOutlet","children":"$@7"}]}]]}],"loading":null,"isPartial":false}
7:null
