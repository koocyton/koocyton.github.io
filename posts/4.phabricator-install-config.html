<!DOCTYPE html><!--xzX2_1_SXXW_pE78bnzy_--><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/9988c12a819fa1cb.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/465f799faf41e6df.js"/><script src="/_next/static/chunks/75db382961acc07c.js" async=""></script><script src="/_next/static/chunks/24fee8b2203ad4c2.js" async=""></script><script src="/_next/static/chunks/045e59273b8f7eaf.js" async=""></script><script src="/_next/static/chunks/turbopack-f3f3717261c5df74.js" async=""></script><script src="/_next/static/chunks/7c92e96509cd355e.js" async=""></script><script src="/_next/static/chunks/eb3523e826d36cf6.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/d2be314c3ece3fbe.js" async=""></script><title>Phabricator安装和配置过程记录 - 一洼绿地</title><meta name="description" content="hive"/><meta name="keywords" content="javascript java php emacs spring linux flutter"/><link rel="icon" href="/img/avatar/favicon.png"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col antialiased"><div hidden=""><!--$--><!--/$--></div><header class="border-b border-[var(--color-border)]"><div class="max-w-2xl mx-auto px-5 h-12 flex items-center justify-between"><a class="font-mono text-sm font-semibold text-[var(--color-text)] hover:text-[var(--color-link)] transition-colors" href="/">一洼绿地</a><nav class="flex items-center gap-5"><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/">文章</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/archives">归档</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/tags">标签</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/about">关于</a><a href="https://github.com/koocyton" target="_blank" rel="noopener noreferrer" class="text-[var(--color-text-tertiary)] hover:text-[var(--color-text)] transition-colors"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></nav></div></header><main class="flex-1"><article class="max-w-2xl mx-auto px-5 py-10"><header class="mb-8"><h1 class="font-mono text-xl font-semibold text-[var(--color-text)] leading-tight">Phabricator安装和配置过程记录</h1><div class="flex items-center gap-3 mt-2 text-xs text-[var(--color-text-tertiary)] font-mono"><time dateTime="2023-01-04">2023-01-04</time><span>·</span><span>14 min read</span></div><div class="flex flex-wrap gap-1.5 mt-3"><a class="text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors" href="/tags/phabricator">#<!-- -->phabricator</a><a class="text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors" href="/tags/git%20server">#<!-- -->git server</a></div></header><div class="prose"><p><img src="/posts/4.phabricator-install-config/phabricator.jpg" alt="phabricator"></p>
<p><a href="https://www.jianshu.com/p/d7630e1fe4f9">Phabricator安装和配置过程记录 - 吴关山</a></p>
<h2>Quick Start</h2>
<h3>简介</h3>
<p>本文介绍Phabricator的安装和配置过程，转至 <a href="https://www.jianshu.com/p/d7630e1fe4f9">https://www.jianshu.com/p/d7630e1fe4f9</a> ，作者 吴关山</p>
<p>Phabricator的安装过程比较繁琐，为了保证得到可靠的过程，步骤在以下公有云平台：</p>
<pre><code class="hljs language-bash">微软Azure国内
阿里云国内
AWS首尔
</code></pre>
<p>分别做了测试。</p>
<p>安装环境为：</p>
<pre><code class="hljs language-bash">Ubuntu 16.04 Server
Nginx
PHP7.1
MySQL
</code></pre>
<p>以下分两个部分：</p>
<p>安装：Phabricator基本安装、运行和检验
配置：发邮件、基于SSH的Git仓库托管以及配置杂项等</p>
<h3>安装</h3>
<h5>clone Phabricator项目文件</h5>
<p>创建目录：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> /var/www/pha
</code></pre>
<p>clone相关项目：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">clone</span> https://github.com/phacility/libphutil.git
<span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">clone</span> https://github.com/phacility/arcanist.git
<span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">clone</span> https://github.com/phacility/phabricator.git
</code></pre>
<p>修改目录所有者，用nginx进程的用户，www-data</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R www-data:www-data /var/www/pha
</code></pre>
<h5>安装Nginx</h5>
<p>使用Nginx官方源。命令如下：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> apt-get install software-properties-common
<span class="hljs-built_in">sudo</span> add-apt-repository ppa:nginx/stable
<span class="hljs-built_in">sudo</span> apt-get update
<span class="hljs-built_in">sudo</span> apt install -y nginx
</code></pre>
<p>安装后，Nginx应自动启动，检查80端口是否正常：</p>
<pre><code class="hljs language-bash">netstat -na | grep 80
</code></pre>
<p>应看到类似这样的结果：</p>
<pre><code class="hljs language-bash"> tcp6       0      0 :::80                   :::*                    LISTEN
</code></pre>
<p>如能找到，说明Nginx安装成功，如无法外网访问，检查防火墙设置。</p>
<p>有关防火墙的设置
后续安装配置，需要允许如下端口的外网访问：</p>
<p>22，将用于git ssh使用
80，默认http
443，https，phabricator正式环境端口
2222，ssh登录端口</p>
<h5>安装PHP环境</h5>
<p>Phabricator不支持PHP7.0版本，需要安装7.1版本：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php
<span class="hljs-built_in">sudo</span> apt-get update
<span class="hljs-built_in">sudo</span> apt-get -y install php7.1 php7.1-mysql php7.1-fpm php7.1-curl php7.1-xml php7.1-mcrypt php7.1-json php7.1-gd php7.1-mbstring
</code></pre>
<p>修改fpm的配置：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /etc/php/7.1/fpm/pool.d/www.conf
</code></pre>
<p>文件内容，在listen = /run/php/php7.1-fpm.sock之后加入2行：</p>
<pre><code class="hljs language-conf">; Note: This value is mandatory.
listen = /run/php/php7.1-fpm.sock
listen = 9000 # 增加
listen.allowed_clients = 127.0.0.1 # 增加
</code></pre>
<p>重启PHP：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> service php7.1-fpm stop
<span class="hljs-built_in">sudo</span> service php7.1-fpm start
</code></pre>
<p>测试配置是否生效：</p>
<pre><code class="hljs language-bash">netstat -na | grep 9000
</code></pre>
<p>如能显示，说明fpm正常启动：</p>
<pre><code class="hljs language-TXT">tcp6       0      0 :::9000                 :::*                    LISTEN
</code></pre>
<p>配置Nginx
域名比如是：p.mydomain.com，那么创建配置文件：/etc/nginx/conf.d/p.mydomain.com.conf，内容如下：</p>
<pre><code class="hljs language-bash">server {
  server_name p.mydomain.com; <span class="hljs-comment"># 配置域名</span>
  root        /var/www/pha/phabricator/webroot; <span class="hljs-comment"># 配置根目录</span>

  location / {
    index index.php;
    rewrite ^/(.*)$ /index.php?__path__=/<span class="hljs-variable">$1</span> last;
  }

  location /index.php {
    fastcgi_pass   localhost:9000;
    fastcgi_index   index.php;

    <span class="hljs-comment">#required if PHP was built with --enable-force-cgi-redirect</span>
    fastcgi_param  REDIRECT_STATUS    200;

    <span class="hljs-comment">#variables to make the $_SERVER populate in PHP</span>
    fastcgi_param  SCRIPT_FILENAME    $document_root<span class="hljs-variable">$fastcgi_script_name</span>;
    fastcgi_param  QUERY_STRING       <span class="hljs-variable">$query_string</span>;
    fastcgi_param  REQUEST_METHOD     <span class="hljs-variable">$request_method</span>;
    fastcgi_param  CONTENT_TYPE       <span class="hljs-variable">$content_type</span>;
    fastcgi_param  CONTENT_LENGTH     <span class="hljs-variable">$content_length</span>;

    fastcgi_param  SCRIPT_NAME        <span class="hljs-variable">$fastcgi_script_name</span>;

    fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;
    fastcgi_param  SERVER_SOFTWARE    nginx/<span class="hljs-variable">$nginx_version</span>;

    fastcgi_param  REMOTE_ADDR        <span class="hljs-variable">$remote_addr</span>;
  }
}
</code></pre>
<h5>安装和配置MySQL</h5>
<h6>安装：</h6>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> apt install mysql-server
</code></pre>
<p>提示输入root用户密码，在本例中，密码是：password</p>
<p>在phabricator目录下（git clone <a href="https://github.com/phacility/phabricator.git">https://github.com/phacility/phabricator.git</a> 的那个目录）执行命令，将mysql密码设置到phabricator：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> mysql.pass <span class="hljs-string">'password'</span>
</code></pre>
<h6>为phabricator创建mysql相关数据表：</h6>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/storage upgrade
</code></pre>
<h5>设置和重启Nginx</h5>
<h6>设置下phabricator的url</h6>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span>  ./bin/config <span class="hljs-built_in">set</span> phabricator.base-uri <span class="hljs-string">'http://p.mydomain.com'</span>
</code></pre>
<h6>Nginx重新加载：</h6>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> service nginx reload
</code></pre>
<p>设置管理员和认证方式
这时，浏览器应该可以访问Phabricator了：<a href="http://p.mydomain.com">http://p.mydomain.com</a></p>
<p>作为第一个访问用户，可创建管理员账号。</p>
<p>注意，管理员不是标准用户。</p>
<p>如果能创建管理员，说明安装过程成功。</p>
<p>这时可以添加认证方式（Auth Provider）。phabricator提供了多种认证方式，其中最基本的是用户名／密码的provider。</p>
<p>作为管理员，访问Auth，选择Add Provider ，然后添加 Username/Password Provider即可。</p>
<p>安装过程到此基本结束，但还不能：</p>
<p>发送用户邀请邮件及其他通知邮件
创建git repository
下一部分将解决这些问题。</p>
<h6>配置</h6>
<p>发送邮件的基本配置
发送邮件的功能是必须配置的，否则无法创建用户，因为需要通过邮件发送邀请通知。</p>
<p>执行如下命令，设置发送邮件邮箱配置：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> metamta.default-address robot@mydomain.com
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> metamta.domain mydomain.com
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> metamta.can-send-as-user <span class="hljs-literal">false</span>
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> metamta.mail-adapter PhabricatorMailImplementationPHPMailerAdapter
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.mailer smtp
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.smtp-host smtp.exmail.qq.com
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.smtp-port 465
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.smtp-user robot@mydomain.com
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.smtp-password my_password
<span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phpmailer.smtp-protocol SSL
</code></pre>
<p>这里使用的是qq企业邮箱配置的。</p>
<p>设置完毕，检查是否可以发送邮件：</p>
<pre><code class="hljs language-bash">./bin/mail send-test --to myname@qq.com --subject hello &#x3C;README.md
</code></pre>
<p>如果能收到邮件，说明邮箱配置正确。</p>
<h5>配置和自启动守护进程</h5>
<p>phabricator有个任务队列，并运行一个守护进程，执行队列中的任务。可在 <a href="http://p.mydomain.com/daemon">http://p.mydomain.com/daemon</a> 中看到Active Daemons中还没有可用的守护进程。</p>
<p>phabricator守护进程，phd，主要负责：</p>
<p>git repository相关的操作
发送邮件
垃圾回收，如旧的日志和缓存
我们可以直接启动守护进程：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/phd start
</code></pre>
<p>但是有问题：</p>
<ul>
<li>当前用户权限过大</li>
<li>需要设置为自启动服务</li>
</ul>
<h5>创建phd用户</h5>
<p>创建phd用户：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> adduser phd --home /home/phd
</code></pre>
<p>使phd用户不可远程登录：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> usermod -p NP phd
</code></pre>
<h5>创建和启动phd自启动服务</h5>
<p>创建systemd service文件/tmp/service.file：</p>
<pre><code class="hljs language-bash">[Unit]
Description=phabricator-phd
After=syslog.target network.target mysql.service
Before=nginx.service

[Service]
Type=oneshot
User=phd
Group=phd
Enviroment=<span class="hljs-string">"PATH=/sbin:/usr/sbin:/usr/local/sbin:/usr/local/bin:/usr/bin:/bin"</span>
ExecStart=/var/www/pha/phabricator/bin/phd start
ExecStop=/var/www/pha/phabricator/bin/phd stop
RemainAfterExit=<span class="hljs-built_in">yes</span>

[Install]
WantedBy=multi-user.target
</code></pre>
<p>将服务加入到systemd目录：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /tmp/service.file /lib/systemd/system/phabricator-phd.service
</code></pre>
<p>使phabricator-phd.service可用：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> phabricator-phd.service
</code></pre>
<p>启动phabricator-phd.service服务：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> systemctl start phabricator-phd
</code></pre>
<p>如没有报错，访问：<a href="http://p.mydomain.com/daemon/">http://p.mydomain.com/daemon/</a> 可以看到Active Daemons不为空了。</p>
<p>将phd用户设置为phd.user:</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> phd.user phd
</code></pre>
<ul>
<li>注：其他用户如需操作git命令，需要sudo为phd用户，上面的设置就是告诉它们需要sudo的用户名。</li>
</ul>
<p>phd用户将守护进程跑起来后，就可以创建新用户了。通过管理员账号，选择people，添加standard用户。会收到邀请邮件，如果phd和邮箱配置都没问题的话。</p>
<p>用这个standard用户登录，并上传public key，后面要用到。</p>
<h5>www-data用户的配置</h5>
<p>如果将来要用到http git时，需要将www-data用户设置为可sudo为phd用户。</p>
<p>编辑/etc/sudoers，加入：</p>
<pre><code class="hljs language-conf">www-data ALL=(phd) SETENV: NOPASSWD: /usr/lib/git-core/git-http-backend
</code></pre>
<p>实际上，我们没有用到这个，我们用的是SSH Git。</p>
<h3>配置SSH Git托管</h3>
<h4>准备工作</h4>
<p>将当前SSH服务转移到2222端口，将来运行的Git SSH服务使用22端口。这是多次配置后，觉得后续比较方便的做法。否则，Git用户都要自定义端口，给开发／部署带来不必要的麻烦。</p>
<p>修改文件：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /etc/ssh/sshd_config
</code></pre>
<p>将Port改为2222后重启ssh服务：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> service ssh restart
</code></pre>
<p>用2222端口ssh重新登录服务器：</p>
<pre><code class="hljs language-bash">ssh -p2222 p.mydomain.com 
</code></pre>
<h5>创建git用户</h5>
<p>创建用户：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> adduser git
</code></pre>
<p>禁止登录：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> usermod -p NP git
</code></pre>
<p>设置git可以sudo为phd，修改/etc/sudoers，加入：</p>
<pre><code class="hljs language-bash">git ALL=(phd) SETENV: NOPASSWD: /usr/bin/git-upload-pack, /usr/bin/git-receive-pack
</code></pre>
<p>创建存放git repository的目录：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> /var/repo
</code></pre>
<p>改变目录所有者为phd：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R phd /var/repo
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chgrp</span> -R phd /var/repo
</code></pre>
<p>phabricator设置git-core路径：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> environment.append-paths <span class="hljs-string">'["/usr/lib/git-core"]'</span>
</code></pre>
<p>phabricator设置git用户：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> diffusion.ssh-user git
</code></pre>
<h5>创建git ssh hook配置文件</h5>
<p>phabricator项目中提供了模版文件，将这个文件复制到需要的地方：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /var/www/pha/phabricator/resources/sshd/phabricator-ssh-hook.sh /usr/lib/phabricator-ssh-hook.sh
</code></pre>
<p>修改文件权限：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 755 /usr/lib/phabricator-ssh-hook.sh
</code></pre>
<p>修改hook文件：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /usr/lib/phabricator-ssh-hook.sh
</code></pre>
<p>文件内容：</p>
<pre><code class="hljs language-bash"><span class="hljs-meta">#!/bin/sh</span>

<span class="hljs-comment"># NOTE: Replace this with the username that you expect users to connect with.</span>
VCSUSER=<span class="hljs-string">"git"</span>  <span class="hljs-comment"># 配置</span>

<span class="hljs-comment"># NOTE: Replace this with the path to your Phabricator directory.</span>
ROOT=<span class="hljs-string">"/var/www/pha/phabricator"</span> <span class="hljs-comment"># 配置</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">$VCSUSER</span>"</span> ];
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">exec</span> <span class="hljs-string">"<span class="hljs-variable">$ROOT</span>/bin/ssh-auth"</span> <span class="hljs-variable">$@</span>
</code></pre>
<h5>创建git ssh配置文件</h5>
<p>phabricator也提供了模版文件，复制到需要的地方：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /var/www/pha/phabricator/resources/sshd/sshd_config.phabricator.example /etc/ssh/sshd_config.phabricator
</code></pre>
<p>修改sshd_config.phabricator文件：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /etc/ssh/sshd_config.phabricator
</code></pre>
<p>文件内容：</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># NOTE: You must have OpenSSHD 6.2 or newer; support for AuthorizedKeysCommand</span>
<span class="hljs-comment"># was added in this version.</span>

<span class="hljs-comment"># NOTE: Edit these to the correct values for your setup.</span>

AuthorizedKeysCommand /usr/lib/phabricator-ssh-hook.sh  <span class="hljs-comment"># 配置</span>
AuthorizedKeysCommandUser git <span class="hljs-comment"># 配置</span>
AllowUsers git <span class="hljs-comment"># 配置</span>

<span class="hljs-comment"># You may need to tweak these options, but mostly they just turn off everything</span>
<span class="hljs-comment"># dangerous.</span>

Port 22 <span class="hljs-comment"># 配置</span>
Protocol 2
PermitRootLogin no
AllowAgentForwarding no
AllowTcpForwarding no
PrintMotd no
PrintLastLog no
PasswordAuthentication no
AuthorizedKeysFile none

PidFile /var/run/sshd-phabricator.pid
</code></pre>
<h5>启动git ssh及测试</h5>
<p>这个步骤，是为了检查前面2个文件是否正确。正式启动git ssh需要后面使用systemd的自启动服务方式。</p>
<p>启动git ssh服务：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> /usr/sbin/sshd -f /etc/ssh/sshd_config.phabricator
</code></pre>
<p>在客户端终端命令行下：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">echo</span> {} | ssh git@p.mydomain.com conduit conduit.ping
</code></pre>
<p>如果出现：</p>
<pre><code class="hljs language-bash">{<span class="hljs-string">"result"</span>:<span class="hljs-string">"hello"</span>,<span class="hljs-string">"error_code"</span>:null,<span class="hljs-string">"error_info"</span>:null}
</code></pre>
<p>就说明成功了。</p>
<p>可能出现的错误：</p>
<p>没有将客户端的public key上传到phabricator，或者不匹配
各种服务器端配置问题，包括用户权限问题
针对服务器端配置问题，可这样启动git ssh服务，参照debug信息一般能找到问题：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> /usr/sbin/sshd -d -d -d -f /etc/ssh/sshd_config.phabricator
</code></pre>
<p>或者可阅读官方文档Diffusion User Guide: Repository Hosting的Troubleshooting SSH部分。</p>
<p>这时，需要杀掉当前启动的phd服务，因为后面要设置自动启动它。</p>
<h5>设置git ssh自启动服务</h5>
<p>复制ssh的服务文件，作为git ssh服务的模版：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /lib/systemd/system/ssh.service /lib/systemd/system/phabricator-ssh.service
</code></pre>
<p>修改phabricator-ssh.service：</p>
<pre><code class="hljs language-conf">[Unit]
Description=OpenBSD Secure Shell server
After=network.target auditd.service
ConditionPathExists=!/etc/ssh/sshd_not_to_be_run

[Service]
EnvironmentFile=-/etc/default/ssh
ExecStart=/usr/sbin/sshd -D $SSHD_OPTS -f /etc/ssh/sshd_config.phabricator # 修改
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
Restart=on-failure
RestartPreventExitStatus=255
Type=notify

[Install]
WantedBy=multi-user.target
</code></pre>
<p>即，修改1行（见代码注释），另外，删除最后一行Alias=sshd.service。</p>
<p>然后：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> phabricator-ssh
<span class="hljs-built_in">sudo</span> systemctl start phabricator-ssh
</code></pre>
<p>再次在客户端测试，如果没有问题，基本上就配置好了。</p>
<h5>配置杂项</h5>
<p>可以在：<a href="http://p.mydomain.com/config/issue/">http://p.mydomain.com/config/issue/</a> 查看配置上的问题，并根据建议做相应修改。</p>
<p>以下给出一些常用的配置情况。</p>
<h5>语法高亮</h5>
<p>安装pigment:</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> apt install  -y python-pygments
</code></pre>
<p>phabricator打开pygments功能：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> pygments.enabled <span class="hljs-literal">true</span>
</code></pre>
<h5>最大下载文件限制</h5>
<p>编辑php配置文件：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /etc/php/7.1/fpm/php.ini
</code></pre>
<p>找到这行并改为：</p>
<pre><code class="hljs language-conf">post_max_size = 100M
</code></pre>
<p>修改Nginx配置文件：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> vim /etc/nginx/nginx.conf
</code></pre>
<p>在http块中加入：</p>
<pre><code class="hljs language-conf">client_max_body_size 100m;
</code></pre>
<p>因为默认使用mysql存储，还需要修改对mysql存储的限制，默认是1M，执行命令：</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">sudo</span> ./bin/config <span class="hljs-built_in">set</span> storage.mysql-engine.max-size 104857600
</code></pre>
<p>重启Nginx。</p>
<h5>增加邮件地址时的报错处理</h5>
<p>在添加邮件地址时出现了这样的报错：</p>
<pre><code class="hljs language-TXT">Unhandled Exception ("AphrontQueryException")   
#1055: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'phabricator_system.system_actionlog.actorIdentity' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
</code></pre>
<p>原因是sql_mode的限制，可连接msyql：</p>
<pre><code class="hljs language-bash">mysql -u root -ppassword
</code></pre>
<p>然后：</p>
<pre><code class="hljs language-SQL"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> sql_mode<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> REPLACE(@<span class="hljs-variable">@sql_mode</span>,<span class="hljs-string">'ONLY_FULL_GROUP_BY'</span>,<span class="hljs-string">''</span>));
</code></pre>
<p>这一问题，也可能会出现在有类似数据库操作的地方。</p>
<p>最后，贴一个配置</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"metamta.default-address"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"send mail account"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cluster.mailers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"email"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"smtp"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"host"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"smtp host"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"port"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">465</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"send mail account"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"send mail password"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"protocol"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ssl"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"diffusion.allow-http-auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"diffusion.ssh-user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"environment.append-paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"/usr/lib/git-core"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"/usr/bin"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"/usr/local/bin"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"phd.user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"phd"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"phabricator.base-uri"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://domain.com/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mysql.pass"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mysql password"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mysql.user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mysql user"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mysql.port"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mysql port"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mysql.host"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"localhost"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pygments.enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"true"</span>
<span class="hljs-punctuation">}</span>
</code></pre></div><div class="mt-12 pt-6 border-t border-[var(--color-border)]"></div><footer class="mt-8 pt-4 border-t border-[var(--color-border)]"><a class="text-sm text-[var(--color-link)] hover:underline" href="/">← 返回</a></footer></article><!--$--><!--/$--></main><footer class="border-t border-[var(--color-border)] py-6"><div class="max-w-2xl mx-auto px-5 text-xs text-[var(--color-text-tertiary)]">© <!-- -->2026<!-- --> koocyton</div></footer><script src="/_next/static/chunks/465f799faf41e6df.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[22016,[\"/_next/static/chunks/7c92e96509cd355e.js\",\"/_next/static/chunks/eb3523e826d36cf6.js\"],\"\"]\n3:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n4:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n9:I[68027,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n:HL[\"/_next/static/chunks/9988c12a819fa1cb.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xzX2-1_SXXW-pE78bnzy_\",\"c\":[\"\",\"posts\",\"4.phabricator-install-config\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"4.phabricator-install-config\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/9988c12a819fa1cb.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/7c92e96509cd355e.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"children\":[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col antialiased\",\"children\":[[\"$\",\"header\",null,{\"className\":\"border-b border-[var(--color-border)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 h-12 flex items-center justify-between\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"font-mono text-sm font-semibold text-[var(--color-text)] hover:text-[var(--color-link)] transition-colors\",\"children\":\"一洼绿地\"}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-5\",\"children\":[[[\"$\",\"$L2\",\"/\",{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"文章\"}],[\"$\",\"$L2\",\"/archives\",{\"href\":\"/archives\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"归档\"}],[\"$\",\"$L2\",\"/tags\",{\"href\":\"/tags\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"标签\"}],[\"$\",\"$L2\",\"/about\",{\"href\":\"/about\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"关于\"}]],[\"$\",\"a\",null,{\"href\":\"https://github.com/koocyton\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-[var(--color-text-tertiary)] hover:text-[var(--color-text)] transition-colors\",\"children\":[\"$\",\"svg\",null,{\"className\":\"w-4 h-4\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 py-20 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-mono text-4xl font-semibold text-[var(--color-text)] mb-2\",\"children\":\"404\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-[var(--color-text-tertiary)] mb-6\",\"children\":\"页面不存在\"}],[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-link)] hover:underline\",\"children\":\"← 返回首页\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t border-[var(--color-border)] py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 text-xs text-[var(--color-text-tertiary)]\",\"children\":[\"© \",2026,\" koocyton\"]}]}]]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[\"$L6\"],\"$L7\"]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$L8\",false]],\"m\":\"$undefined\",\"G\":[\"$9\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"a:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"OutletBoundary\"]\nb:\"$Sreact.suspense\"\nd:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"ViewportBoundary\"]\nf:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"MetadataBoundary\"]\n6:[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/eb3523e826d36cf6.js\",\"async\":true,\"nonce\":\"$undefined\"}]\n7:[\"$\",\"$La\",null,{\"children\":[\"$\",\"$b\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@c\"}]}]\n8:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lf\",null,{\"children\":[\"$\",\"$b\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L10\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"11:T6c2f,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003cimg src=\"/posts/4.phabricator-install-config/phabricator.jpg\" alt=\"phabricator\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.jianshu.com/p/d7630e1fe4f9\"\u003ePhabricator安装和配置过程记录 - 吴关山\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eQuick Start\u003c/h2\u003e\n\u003ch3\u003e简介\u003c/h3\u003e\n\u003cp\u003e本文介绍Phabricator的安装和配置过程，转至 \u003ca href=\"https://www.jianshu.com/p/d7630e1fe4f9\"\u003ehttps://www.jianshu.com/p/d7630e1fe4f9\u003c/a\u003e ，作者 吴关山\u003c/p\u003e\n\u003cp\u003ePhabricator的安装过程比较繁琐，为了保证得到可靠的过程，步骤在以下公有云平台：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e微软Azure国内\n阿里云国内\nAWS首尔\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e分别做了测试。\u003c/p\u003e\n\u003cp\u003e安装环境为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eUbuntu 16.04 Server\nNginx\nPHP7.1\nMySQL\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e以下分两个部分：\u003c/p\u003e\n\u003cp\u003e安装：Phabricator基本安装、运行和检验\n配置：发邮件、基于SSH的Git仓库托管以及配置杂项等\u003c/p\u003e\n\u003ch3\u003e安装\u003c/h3\u003e\n\u003ch5\u003eclone Phabricator项目文件\u003c/h5\u003e\n\u003cp\u003e创建目录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e /var/www/pha\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eclone相关项目：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e git \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/phacility/libphutil.git\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e git \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/phacility/arcanist.git\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e git \u003cspan class=\"hljs-built_in\"\u003eclone\u003c/span\u003e https://github.com/phacility/phabricator.git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改目录所有者，用nginx进程的用户，www-data\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echown\u003c/span\u003e -R www-data:www-data /var/www/pha\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e安装Nginx\u003c/h5\u003e\n\u003cp\u003e使用Nginx官方源。命令如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt-get install software-properties-common\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e add-apt-repository ppa:nginx/stable\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt-get update\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt install -y nginx\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e安装后，Nginx应自动启动，检查80端口是否正常：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enetstat -na | grep 80\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e应看到类似这样的结果：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e tcp6       0      0 :::80                   :::*                    LISTEN\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如能找到，说明Nginx安装成功，如无法外网访问，检查防火墙设置。\u003c/p\u003e\n\u003cp\u003e有关防火墙的设置\n后续安装配置，需要允许如下端口的外网访问：\u003c/p\u003e\n\u003cp\u003e22，将用于git ssh使用\n80，默认http\n443，https，phabricator正式环境端口\n2222，ssh登录端口\u003c/p\u003e\n\u003ch5\u003e安装PHP环境\u003c/h5\u003e\n\u003cp\u003ePhabricator不支持PHP7.0版本，需要安装7.1版本：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt-get update\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt-get -y install php7.1 php7.1-mysql php7.1-fpm php7.1-curl php7.1-xml php7.1-mcrypt php7.1-json php7.1-gd php7.1-mbstring\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改fpm的配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /etc/php/7.1/fpm/pool.d/www.conf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e文件内容，在listen = /run/php/php7.1-fpm.sock之后加入2行：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-conf\"\u003e; Note: This value is mandatory.\nlisten = /run/php/php7.1-fpm.sock\nlisten = 9000 # 增加\nlisten.allowed_clients = 127.0.0.1 # 增加\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e重启PHP：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e service php7.1-fpm stop\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e service php7.1-fpm start\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试配置是否生效：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enetstat -na | grep 9000\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如能显示，说明fpm正常启动：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-TXT\"\u003etcp6       0      0 :::9000                 :::*                    LISTEN\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e配置Nginx\n域名比如是：p.mydomain.com，那么创建配置文件：/etc/nginx/conf.d/p.mydomain.com.conf，内容如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eserver {\n  server_name p.mydomain.com; \u003cspan class=\"hljs-comment\"\u003e# 配置域名\u003c/span\u003e\n  root        /var/www/pha/phabricator/webroot; \u003cspan class=\"hljs-comment\"\u003e# 配置根目录\u003c/span\u003e\n\n  location / {\n    index index.php;\n    rewrite ^/(.*)$ /index.php?__path__=/\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e last;\n  }\n\n  location /index.php {\n    fastcgi_pass   localhost:9000;\n    fastcgi_index   index.php;\n\n    \u003cspan class=\"hljs-comment\"\u003e#required if PHP was built with --enable-force-cgi-redirect\u003c/span\u003e\n    fastcgi_param  REDIRECT_STATUS    200;\n\n    \u003cspan class=\"hljs-comment\"\u003e#variables to make the $_SERVER populate in PHP\u003c/span\u003e\n    fastcgi_param  SCRIPT_FILENAME    $document_root\u003cspan class=\"hljs-variable\"\u003e$fastcgi_script_name\u003c/span\u003e;\n    fastcgi_param  QUERY_STRING       \u003cspan class=\"hljs-variable\"\u003e$query_string\u003c/span\u003e;\n    fastcgi_param  REQUEST_METHOD     \u003cspan class=\"hljs-variable\"\u003e$request_method\u003c/span\u003e;\n    fastcgi_param  CONTENT_TYPE       \u003cspan class=\"hljs-variable\"\u003e$content_type\u003c/span\u003e;\n    fastcgi_param  CONTENT_LENGTH     \u003cspan class=\"hljs-variable\"\u003e$content_length\u003c/span\u003e;\n\n    fastcgi_param  SCRIPT_NAME        \u003cspan class=\"hljs-variable\"\u003e$fastcgi_script_name\u003c/span\u003e;\n\n    fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;\n    fastcgi_param  SERVER_SOFTWARE    nginx/\u003cspan class=\"hljs-variable\"\u003e$nginx_version\u003c/span\u003e;\n\n    fastcgi_param  REMOTE_ADDR        \u003cspan class=\"hljs-variable\"\u003e$remote_addr\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e安装和配置MySQL\u003c/h5\u003e\n\u003ch6\u003e安装：\u003c/h6\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt install mysql-server\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e提示输入root用户密码，在本例中，密码是：password\u003c/p\u003e\n\u003cp\u003e在phabricator目录下（git clone \u003ca href=\"https://github.com/phacility/phabricator.git\"\u003ehttps://github.com/phacility/phabricator.git\u003c/a\u003e 的那个目录）执行命令，将mysql密码设置到phabricator：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e mysql.pass \u003cspan class=\"hljs-string\"\u003e'password'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch6\u003e为phabricator创建mysql相关数据表：\u003c/h6\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/storage upgrade\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e设置和重启Nginx\u003c/h5\u003e\n\u003ch6\u003e设置下phabricator的url\u003c/h6\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e  ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phabricator.base-uri \u003cspan class=\"hljs-string\"\u003e'http://p.mydomain.com'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch6\u003eNginx重新加载：\u003c/h6\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e service nginx reload\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置管理员和认证方式\n这时，浏览器应该可以访问Phabricator了：\u003ca href=\"http://p.mydomain.com\"\u003ehttp://p.mydomain.com\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e作为第一个访问用户，可创建管理员账号。\u003c/p\u003e\n\u003cp\u003e注意，管理员不是标准用户。\u003c/p\u003e\n\u003cp\u003e如果能创建管理员，说明安装过程成功。\u003c/p\u003e\n\u003cp\u003e这时可以添加认证方式（Auth Provider）。phabricator提供了多种认证方式，其中最基本的是用户名／密码的provider。\u003c/p\u003e\n\u003cp\u003e作为管理员，访问Auth，选择Add Provider ，然后添加 Username/Password Provider即可。\u003c/p\u003e\n\u003cp\u003e安装过程到此基本结束，但还不能：\u003c/p\u003e\n\u003cp\u003e发送用户邀请邮件及其他通知邮件\n创建git repository\n下一部分将解决这些问题。\u003c/p\u003e\n\u003ch6\u003e配置\u003c/h6\u003e\n\u003cp\u003e发送邮件的基本配置\n发送邮件的功能是必须配置的，否则无法创建用户，因为需要通过邮件发送邀请通知。\u003c/p\u003e\n\u003cp\u003e执行如下命令，设置发送邮件邮箱配置：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e metamta.default-address robot@mydomain.com\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e metamta.domain mydomain.com\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e metamta.can-send-as-user \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e metamta.mail-adapter PhabricatorMailImplementationPHPMailerAdapter\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.mailer smtp\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.smtp-host smtp.exmail.qq.com\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.smtp-port 465\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.smtp-user robot@mydomain.com\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.smtp-password my_password\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phpmailer.smtp-protocol SSL\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里使用的是qq企业邮箱配置的。\u003c/p\u003e\n\u003cp\u003e设置完毕，检查是否可以发送邮件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e./bin/mail send-test --to myname@qq.com --subject hello \u0026#x3C;README.md\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果能收到邮件，说明邮箱配置正确。\u003c/p\u003e\n\u003ch5\u003e配置和自启动守护进程\u003c/h5\u003e\n\u003cp\u003ephabricator有个任务队列，并运行一个守护进程，执行队列中的任务。可在 \u003ca href=\"http://p.mydomain.com/daemon\"\u003ehttp://p.mydomain.com/daemon\u003c/a\u003e 中看到Active Daemons中还没有可用的守护进程。\u003c/p\u003e\n\u003cp\u003ephabricator守护进程，phd，主要负责：\u003c/p\u003e\n\u003cp\u003egit repository相关的操作\n发送邮件\n垃圾回收，如旧的日志和缓存\n我们可以直接启动守护进程：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/phd start\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是有问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e当前用户权限过大\u003c/li\u003e\n\u003cli\u003e需要设置为自启动服务\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5\u003e创建phd用户\u003c/h5\u003e\n\u003cp\u003e创建phd用户：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e adduser phd --home /home/phd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使phd用户不可远程登录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e usermod -p NP phd\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e创建和启动phd自启动服务\u003c/h5\u003e\n\u003cp\u003e创建systemd service文件/tmp/service.file：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e[Unit]\nDescription=phabricator-phd\nAfter=syslog.target network.target mysql.service\nBefore=nginx.service\n\n[Service]\nType=oneshot\nUser=phd\nGroup=phd\nEnviroment=\u003cspan class=\"hljs-string\"\u003e\"PATH=/sbin:/usr/sbin:/usr/local/sbin:/usr/local/bin:/usr/bin:/bin\"\u003c/span\u003e\nExecStart=/var/www/pha/phabricator/bin/phd start\nExecStop=/var/www/pha/phabricator/bin/phd stop\nRemainAfterExit=\u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e\n\n[Install]\nWantedBy=multi-user.target\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将服务加入到systemd目录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e /tmp/service.file /lib/systemd/system/phabricator-phd.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使phabricator-phd.service可用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e systemctl \u003cspan class=\"hljs-built_in\"\u003eenable\u003c/span\u003e phabricator-phd.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e启动phabricator-phd.service服务：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e systemctl start phabricator-phd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如没有报错，访问：\u003ca href=\"http://p.mydomain.com/daemon/\"\u003ehttp://p.mydomain.com/daemon/\u003c/a\u003e 可以看到Active Daemons不为空了。\u003c/p\u003e\n\u003cp\u003e将phd用户设置为phd.user:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e phd.user phd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e注：其他用户如需操作git命令，需要sudo为phd用户，上面的设置就是告诉它们需要sudo的用户名。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ephd用户将守护进程跑起来后，就可以创建新用户了。通过管理员账号，选择people，添加standard用户。会收到邀请邮件，如果phd和邮箱配置都没问题的话。\u003c/p\u003e\n\u003cp\u003e用这个standard用户登录，并上传public key，后面要用到。\u003c/p\u003e\n\u003ch5\u003ewww-data用户的配置\u003c/h5\u003e\n\u003cp\u003e如果将来要用到http git时，需要将www-data用户设置为可sudo为phd用户。\u003c/p\u003e\n\u003cp\u003e编辑/etc/sudoers，加入：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-conf\"\u003ewww-data ALL=(phd) SETENV: NOPASSWD: /usr/lib/git-core/git-http-backend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e实际上，我们没有用到这个，我们用的是SSH Git。\u003c/p\u003e\n\u003ch3\u003e配置SSH Git托管\u003c/h3\u003e\n\u003ch4\u003e准备工作\u003c/h4\u003e\n\u003cp\u003e将当前SSH服务转移到2222端口，将来运行的Git SSH服务使用22端口。这是多次配置后，觉得后续比较方便的做法。否则，Git用户都要自定义端口，给开发／部署带来不必要的麻烦。\u003c/p\u003e\n\u003cp\u003e修改文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /etc/ssh/sshd_config\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将Port改为2222后重启ssh服务：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e service ssh restart\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e用2222端口ssh重新登录服务器：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003essh -p2222 p.mydomain.com \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e创建git用户\u003c/h5\u003e\n\u003cp\u003e创建用户：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e adduser git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e禁止登录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e usermod -p NP git\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置git可以sudo为phd，修改/etc/sudoers，加入：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egit ALL=(phd) SETENV: NOPASSWD: /usr/bin/git-upload-pack, /usr/bin/git-receive-pack\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e创建存放git repository的目录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e /var/repo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e改变目录所有者为phd：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echown\u003c/span\u003e -R phd /var/repo\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echgrp\u003c/span\u003e -R phd /var/repo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ephabricator设置git-core路径：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e environment.append-paths \u003cspan class=\"hljs-string\"\u003e'[\"/usr/lib/git-core\"]'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ephabricator设置git用户：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e diffusion.ssh-user git\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e创建git ssh hook配置文件\u003c/h5\u003e\n\u003cp\u003ephabricator项目中提供了模版文件，将这个文件复制到需要的地方：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e /var/www/pha/phabricator/resources/sshd/phabricator-ssh-hook.sh /usr/lib/phabricator-ssh-hook.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改文件权限：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e 755 /usr/lib/phabricator-ssh-hook.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改hook文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /usr/lib/phabricator-ssh-hook.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e文件内容：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-meta\"\u003e#!/bin/sh\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# NOTE: Replace this with the username that you expect users to connect with.\u003c/span\u003e\nVCSUSER=\u003cspan class=\"hljs-string\"\u003e\"git\"\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# NOTE: Replace this with the path to your Phabricator directory.\u003c/span\u003e\nROOT=\u003cspan class=\"hljs-string\"\u003e\"/var/www/pha/phabricator\"\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e [ \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e\"\u003c/span\u003e != \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$VCSUSER\u003c/span\u003e\"\u003c/span\u003e ];\n\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e 1\n\u003cspan class=\"hljs-keyword\"\u003efi\u003c/span\u003e\n\n\u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$ROOT\u003c/span\u003e/bin/ssh-auth\"\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$@\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e创建git ssh配置文件\u003c/h5\u003e\n\u003cp\u003ephabricator也提供了模版文件，复制到需要的地方：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e /var/www/pha/phabricator/resources/sshd/sshd_config.phabricator.example /etc/ssh/sshd_config.phabricator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改sshd_config.phabricator文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /etc/ssh/sshd_config.phabricator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e文件内容：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# NOTE: You must have OpenSSHD 6.2 or newer; support for AuthorizedKeysCommand\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# was added in this version.\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# NOTE: Edit these to the correct values for your setup.\u003c/span\u003e\n\nAuthorizedKeysCommand /usr/lib/phabricator-ssh-hook.sh  \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\nAuthorizedKeysCommandUser git \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\nAllowUsers git \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# You may need to tweak these options, but mostly they just turn off everything\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# dangerous.\u003c/span\u003e\n\nPort 22 \u003cspan class=\"hljs-comment\"\u003e# 配置\u003c/span\u003e\nProtocol 2\nPermitRootLogin no\nAllowAgentForwarding no\nAllowTcpForwarding no\nPrintMotd no\nPrintLastLog no\nPasswordAuthentication no\nAuthorizedKeysFile none\n\nPidFile /var/run/sshd-phabricator.pid\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e启动git ssh及测试\u003c/h5\u003e\n\u003cp\u003e这个步骤，是为了检查前面2个文件是否正确。正式启动git ssh需要后面使用systemd的自启动服务方式。\u003c/p\u003e\n\u003cp\u003e启动git ssh服务：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/sbin/sshd -f /etc/ssh/sshd_config.phabricator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在客户端终端命令行下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e {} | ssh git@p.mydomain.com conduit conduit.ping\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果出现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e{\u003cspan class=\"hljs-string\"\u003e\"result\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"hello\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"error_code\"\u003c/span\u003e:null,\u003cspan class=\"hljs-string\"\u003e\"error_info\"\u003c/span\u003e:null}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e就说明成功了。\u003c/p\u003e\n\u003cp\u003e可能出现的错误：\u003c/p\u003e\n\u003cp\u003e没有将客户端的public key上传到phabricator，或者不匹配\n各种服务器端配置问题，包括用户权限问题\n针对服务器端配置问题，可这样启动git ssh服务，参照debug信息一般能找到问题：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/sbin/sshd -d -d -d -f /etc/ssh/sshd_config.phabricator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e或者可阅读官方文档Diffusion User Guide: Repository Hosting的Troubleshooting SSH部分。\u003c/p\u003e\n\u003cp\u003e这时，需要杀掉当前启动的phd服务，因为后面要设置自动启动它。\u003c/p\u003e\n\u003ch5\u003e设置git ssh自启动服务\u003c/h5\u003e\n\u003cp\u003e复制ssh的服务文件，作为git ssh服务的模版：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e /lib/systemd/system/ssh.service /lib/systemd/system/phabricator-ssh.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改phabricator-ssh.service：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-conf\"\u003e[Unit]\nDescription=OpenBSD Secure Shell server\nAfter=network.target auditd.service\nConditionPathExists=!/etc/ssh/sshd_not_to_be_run\n\n[Service]\nEnvironmentFile=-/etc/default/ssh\nExecStart=/usr/sbin/sshd -D $SSHD_OPTS -f /etc/ssh/sshd_config.phabricator # 修改\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=process\nRestart=on-failure\nRestartPreventExitStatus=255\nType=notify\n\n[Install]\nWantedBy=multi-user.target\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e即，修改1行（见代码注释），另外，删除最后一行Alias=sshd.service。\u003c/p\u003e\n\u003cp\u003e然后：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e systemctl \u003cspan class=\"hljs-built_in\"\u003eenable\u003c/span\u003e phabricator-ssh\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e systemctl start phabricator-ssh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次在客户端测试，如果没有问题，基本上就配置好了。\u003c/p\u003e\n\u003ch5\u003e配置杂项\u003c/h5\u003e\n\u003cp\u003e可以在：\u003ca href=\"http://p.mydomain.com/config/issue/\"\u003ehttp://p.mydomain.com/config/issue/\u003c/a\u003e 查看配置上的问题，并根据建议做相应修改。\u003c/p\u003e\n\u003cp\u003e以下给出一些常用的配置情况。\u003c/p\u003e\n\u003ch5\u003e语法高亮\u003c/h5\u003e\n\u003cp\u003e安装pigment:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e apt install  -y python-pygments\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ephabricator打开pygments功能：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e pygments.enabled \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch5\u003e最大下载文件限制\u003c/h5\u003e\n\u003cp\u003e编辑php配置文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /etc/php/7.1/fpm/php.ini\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e找到这行并改为：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-conf\"\u003epost_max_size = 100M\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改Nginx配置文件：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e vim /etc/nginx/nginx.conf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在http块中加入：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-conf\"\u003eclient_max_body_size 100m;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e因为默认使用mysql存储，还需要修改对mysql存储的限制，默认是1M，执行命令：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e ./bin/config \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e storage.mysql-engine.max-size 104857600\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e重启Nginx。\u003c/p\u003e\n\u003ch5\u003e增加邮件地址时的报错处理\u003c/h5\u003e\n\u003cp\u003e在添加邮件地址时出现了这样的报错：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-TXT\"\u003eUnhandled Exception (\"AphrontQueryException\")   \n#1055: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'phabricator_system.system_actionlog.actorIdentity' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e原因是sql_mode的限制，可连接msyql：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emysql -u root -ppassword\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-SQL\"\u003e\u003cspan class=\"hljs-keyword\"\u003eSET\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eGLOBAL\u003c/span\u003e sql_mode\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003eSELECT\u003c/span\u003e REPLACE(@\u003cspan class=\"hljs-variable\"\u003e@sql_mode\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'ONLY_FULL_GROUP_BY'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这一问题，也可能会出现在有类似数据库操作的地方。\u003c/p\u003e\n\u003cp\u003e最后，贴一个配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"metamta.default-address\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"send mail account\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"cluster.mailers\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"key\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"smtp\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003e\"options\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"host\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"smtp host\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"port\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e465\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"send mail account\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"password\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"send mail password\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"protocol\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssl\"\u003c/span\u003e\n      \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"diffusion.allow-http-auth\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"false\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"diffusion.ssh-user\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"git\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"environment.append-paths\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\"/usr/lib/git-core\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\"/usr/bin\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\"/usr/local/bin\"\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"phd.user\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"phd\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"phabricator.base-uri\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"https://domain.com/\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"mysql.pass\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"mysql password\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"mysql.user\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"mysql user\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"mysql.port\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"mysql port\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"mysql.host\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"pygments.enabled\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"className\":\"max-w-2xl mx-auto px-5 py-10\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-mono text-xl font-semibold text-[var(--color-text)] leading-tight\",\"children\":\"Phabricator安装和配置过程记录\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3 mt-2 text-xs text-[var(--color-text-tertiary)] font-mono\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2023-01-04\",\"children\":\"2023-01-04\"}],[\"$\",\"span\",null,{\"children\":\"·\"}],[\"$\",\"span\",null,{\"children\":\"14 min read\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-1.5 mt-3\",\"children\":[[\"$\",\"$L2\",\"phabricator\",{\"href\":\"/tags/phabricator\",\"className\":\"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors\",\"children\":[\"#\",\"phabricator\"]}],[\"$\",\"$L2\",\"git server\",{\"href\":\"/tags/git%20server\",\"className\":\"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors\",\"children\":[\"#\",\"git server\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"prose\",\"dangerouslySetInnerHTML\":{\"__html\":\"$11\"}}],\"$L12\",\"$L13\"]}]\n"])</script><script>self.__next_f.push([1,"14:I[31175,[\"/_next/static/chunks/7c92e96509cd355e.js\",\"/_next/static/chunks/eb3523e826d36cf6.js\"],\"default\"]\n12:[\"$\",\"$L14\",null,{}]\n13:[\"$\",\"footer\",null,{\"className\":\"mt-8 pt-4 border-t border-[var(--color-border)]\",\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-link)] hover:underline\",\"children\":\"← 返回\"}]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"IconMark\"]\nc:null\n10:[[\"$\",\"title\",\"0\",{\"children\":\"Phabricator安装和配置过程记录 - 一洼绿地\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"hive\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"javascript java php emacs spring linux flutter\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/img/avatar/favicon.png\"}],[\"$\",\"$L15\",\"4\",{}]]\n"])</script></body></html>