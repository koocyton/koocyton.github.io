<!DOCTYPE html><!--xzX2_1_SXXW_pE78bnzy_--><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/9988c12a819fa1cb.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/465f799faf41e6df.js"/><script src="/_next/static/chunks/75db382961acc07c.js" async=""></script><script src="/_next/static/chunks/24fee8b2203ad4c2.js" async=""></script><script src="/_next/static/chunks/045e59273b8f7eaf.js" async=""></script><script src="/_next/static/chunks/turbopack-f3f3717261c5df74.js" async=""></script><script src="/_next/static/chunks/7c92e96509cd355e.js" async=""></script><script src="/_next/static/chunks/eb3523e826d36cf6.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/d2be314c3ece3fbe.js" async=""></script><title>Rust 通过 JNI 提供加密解密接口 - 一洼绿地</title><meta name="description" content="Rust 通过 JNI 提供加密解密接口"/><meta name="keywords" content="javascript java php emacs spring linux flutter"/><link rel="icon" href="/img/avatar/favicon.png"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col antialiased"><div hidden=""><!--$--><!--/$--></div><header class="border-b border-[var(--color-border)]"><div class="max-w-2xl mx-auto px-5 h-12 flex items-center justify-between"><a class="font-mono text-sm font-semibold text-[var(--color-text)] hover:text-[var(--color-link)] transition-colors" href="/">一洼绿地</a><nav class="flex items-center gap-5"><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/">文章</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/archives">归档</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/tags">标签</a><a class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" href="/about">关于</a><a href="https://github.com/koocyton" target="_blank" rel="noopener noreferrer" class="text-[var(--color-text-tertiary)] hover:text-[var(--color-text)] transition-colors"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></nav></div></header><main class="flex-1"><article class="max-w-2xl mx-auto px-5 py-10"><header class="mb-8"><h1 class="font-mono text-xl font-semibold text-[var(--color-text)] leading-tight">Rust 通过 JNI 提供加密解密接口</h1><div class="flex items-center gap-3 mt-2 text-xs text-[var(--color-text-tertiary)] font-mono"><time dateTime="2023-01-08">2023-01-08</time><span>·</span><span>5 min read</span></div><div class="flex flex-wrap gap-1.5 mt-3"><a class="text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors" href="/tags/rust">#<!-- -->rust</a></div></header><div class="prose"><h3>目标</h3>
<p>在配置 Java 项目时，配制参数通过 AES 来加密，但反编译 class，很容易拿到秘钥，
Rust 开发 JNI 提供给 java 接口，是一个相对安全的方法(不是绝对安全)。</p>
<h3>配置 Cargo.toml</h3>
<pre><code class="hljs language-bash">[package]
name = <span class="hljs-string">"jniutil"</span>
version = <span class="hljs-string">"0.2.1"</span>
authors = [<span class="hljs-string">"koocyton &#x3C;koocyton@gmail.com>"</span>]
edition = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

[dependencies]
jni = <span class="hljs-string">"0.19.0"</span>
rust-crypto = <span class="hljs-string">"0.2"</span>
clap = <span class="hljs-string">"2.33"</span>
hex = <span class="hljs-string">"0.4"</span>
<span class="hljs-built_in">base64</span> = <span class="hljs-string">"0.13.0"</span>
<span class="hljs-comment"># reqwest = { version = "0.11", features = ["json"] }</span>
<span class="hljs-comment"># tokio = { version = "1.0", features = ["full"] }</span>
<span class="hljs-comment"># futures = { version = "0.3.*" }</span>
<span class="hljs-comment"># async-std = { version = "1", features = ["attributes", "tokio1"] }</span>

[lib]
crate_type = [<span class="hljs-string">"cdylib"</span>]
</code></pre>
<h3>代码 /src/lib.rs</h3>
<pre><code class="hljs language-rust"><span class="hljs-comment">// This is the interface to the JVM that we'll</span>
<span class="hljs-comment">// call the majority of our methods on.</span>
<span class="hljs-keyword">use</span> jni::JNIEnv;

<span class="hljs-comment">// These objects are what you should use as arguments to your native function.</span>
<span class="hljs-comment">// They carry extra lifetime information to prevent them escaping this context</span>
<span class="hljs-comment">// and getting used after being GC'd.</span>
<span class="hljs-keyword">use</span> jni::objects::{JClass, JString};

<span class="hljs-comment">// This is just a pointer. We'll be returning it from our function.</span>
<span class="hljs-comment">// We can't return one of the objects with lifetime information because the</span>
<span class="hljs-comment">// lifetime checker won't let us.</span>
<span class="hljs-keyword">use</span> jni::sys::jstring;

<span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> crypto::aes::KeySize::KeySize128;
<span class="hljs-keyword">use</span> crypto::blockmodes::PkcsPadding;
<span class="hljs-keyword">use</span> crypto::buffer::{RefReadBuffer, RefWriteBuffer};

<span class="hljs-keyword">const</span> DP_CBC_KEY: &#x26;<span class="hljs-type">str</span>    = <span class="hljs-string">"1111111111111111"</span>;
<span class="hljs-keyword">const</span> DP_CBC_OFFSET: &#x26;<span class="hljs-type">str</span> = <span class="hljs-string">"1111111111111111"</span>;

<span class="hljs-comment">// 注意包名 com_doopp_common_util_JniUtil</span>
<span class="hljs-meta">#[no_mangle]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"system"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">Java_com_doopp_common_util_JniUtil_dpEnc</span>(
    env: JNIEnv,
    <span class="hljs-comment">// this is the class that owns our</span>
    <span class="hljs-comment">// static method. Not going to be</span>
    <span class="hljs-comment">// used, but still needs to have</span>
    <span class="hljs-comment">// an argument slot</span>
    _class: JClass,
    input: JString,
) <span class="hljs-punctuation">-></span> jstring {
    <span class="hljs-comment">// First, we have to get the string out of java. Check out the `strings`</span>
    <span class="hljs-comment">// module for more info on how this works.</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable">input</span>: <span class="hljs-type">String</span> = env
        .<span class="hljs-title function_ invoke__">get_string</span>(input)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Couldn't get java string!"</span>)
        .<span class="hljs-title function_ invoke__">into</span>();
    <span class="hljs-comment">// Then we have to create a new java string to return. Again, more info</span>
    <span class="hljs-comment">// in the `strings` module.</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable">enc_str</span>: <span class="hljs-type">String</span> = <span class="hljs-title function_ invoke__">encrypt</span>(DP_CBC_KEY, DP_CBC_OFFSET, input.<span class="hljs-title function_ invoke__">as_str</span>()).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">output</span> = env
        .<span class="hljs-title function_ invoke__">new_string</span>(enc_str)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Couldn't get encrypt string!"</span>);
    <span class="hljs-comment">// Finally, extract the raw pointer to return.</span>
    output.<span class="hljs-title function_ invoke__">into_inner</span>()
}

<span class="hljs-comment">// 注意包名 com_doopp_common_util_JniUtil</span>
<span class="hljs-meta">#[no_mangle]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"system"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">Java_com_doopp_common_util_JniUtil_dpDec</span>(
    env: JNIEnv,
    <span class="hljs-comment">// this is the class that owns our</span>
    <span class="hljs-comment">// static method. Not going to be</span>
    <span class="hljs-comment">// used, but still needs to have</span>
    <span class="hljs-comment">// an argument slot</span>
    _class: JClass,
    input: JString,
) <span class="hljs-punctuation">-></span> jstring {
    <span class="hljs-comment">// First, we have to get the string out of java. Check out the `strings`</span>
    <span class="hljs-comment">// module for more info on how this works.</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable">input</span>: <span class="hljs-type">String</span> = env
        .<span class="hljs-title function_ invoke__">get_string</span>(input)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Couldn't get java string!"</span>)
        .<span class="hljs-title function_ invoke__">into</span>();
    <span class="hljs-comment">// Then we have to create a new java string to return. Again, more info</span>
    <span class="hljs-comment">// in the `strings` module.</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable">dec_str</span>: <span class="hljs-type">String</span> = <span class="hljs-title function_ invoke__">decrypt</span>(DP_CBC_KEY, DP_CBC_OFFSET, input.<span class="hljs-title function_ invoke__">as_str</span>()).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">output</span> = env
        .<span class="hljs-title function_ invoke__">new_string</span>(dec_str)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Couldn't get decrypt string!"</span>);
    <span class="hljs-comment">// Finally, extract the raw pointer to return.</span>
    output.<span class="hljs-title function_ invoke__">into_inner</span>()
}

<span class="hljs-comment">/// 加密</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">encrypt</span>(key: &#x26;<span class="hljs-type">str</span>, iv: &#x26;<span class="hljs-type">str</span>, text: &#x26;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-></span> <span class="hljs-type">Result</span>&#x3C;<span class="hljs-type">String</span>, <span class="hljs-type">Box</span>&#x3C;<span class="hljs-keyword">dyn</span> Error>> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">encrypt</span> = crypto::aes::<span class="hljs-title function_ invoke__">cbc_encryptor</span>(
        KeySize128,
        key.<span class="hljs-title function_ invoke__">as_bytes</span>(),
        iv.<span class="hljs-title function_ invoke__">as_bytes</span>(),
        PkcsPadding
    );
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">read_buffer</span> = RefReadBuffer::<span class="hljs-title function_ invoke__">new</span>(text.<span class="hljs-title function_ invoke__">as_bytes</span>());
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">result</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; <span class="hljs-number">4096</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">write_buffer</span> = RefWriteBuffer::<span class="hljs-title function_ invoke__">new</span>(&#x26;<span class="hljs-keyword">mut</span> result);
    encrypt.<span class="hljs-title function_ invoke__">encrypt</span>(&#x26;<span class="hljs-keyword">mut</span> read_buffer, &#x26;<span class="hljs-keyword">mut</span> write_buffer, <span class="hljs-literal">true</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">enc_str</span> = base64::<span class="hljs-title function_ invoke__">encode_config</span>(<span class="hljs-title function_ invoke__">trim</span>(&#x26;result)?, base64::STANDARD);
    <span class="hljs-title function_ invoke__">Ok</span>(enc_str)
}

<span class="hljs-comment">/// 解密</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">decrypt</span>(key: &#x26;<span class="hljs-type">str</span>, iv: &#x26;<span class="hljs-type">str</span>, input: &#x26;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-></span> <span class="hljs-type">Result</span>&#x3C;<span class="hljs-type">String</span>, <span class="hljs-type">Box</span>&#x3C;<span class="hljs-keyword">dyn</span> Error>> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">decrypt</span> = crypto::aes::<span class="hljs-title function_ invoke__">cbc_decryptor</span>(
        KeySize128,
        key.<span class="hljs-title function_ invoke__">as_bytes</span>(),
        iv.<span class="hljs-title function_ invoke__">as_bytes</span>(),
        PkcsPadding
    );
    <span class="hljs-keyword">let</span> <span class="hljs-variable">base_text</span> = base64::<span class="hljs-title function_ invoke__">decode_config</span>(input, base64::STANDARD)?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">read_buffer</span> = RefReadBuffer::<span class="hljs-title function_ invoke__">new</span>(&#x26;base_text);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">result</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; input.<span class="hljs-title function_ invoke__">len</span>()];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">write_buffer</span> = RefWriteBuffer::<span class="hljs-title function_ invoke__">new</span>(&#x26;<span class="hljs-keyword">mut</span> result);
    decrypt.<span class="hljs-title function_ invoke__">decrypt</span>(&#x26;<span class="hljs-keyword">mut</span> read_buffer, &#x26;<span class="hljs-keyword">mut</span> write_buffer, <span class="hljs-literal">true</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">dec_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from_utf8</span>(<span class="hljs-title function_ invoke__">trim</span>(&#x26;result)?)?;
    <span class="hljs-title function_ invoke__">Ok</span>(dec_str)
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">trim</span>(input: &#x26;<span class="hljs-type">Vec</span>&#x3C;<span class="hljs-type">u8</span>>)  <span class="hljs-punctuation">-></span> <span class="hljs-type">Result</span>&#x3C;<span class="hljs-type">Vec</span>&#x3C;<span class="hljs-type">u8</span>>, <span class="hljs-type">Box</span>&#x3C;<span class="hljs-keyword">dyn</span> Error>> {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">zero</span> : <span class="hljs-type">u8</span> = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">fz_idx</span> = input.<span class="hljs-title function_ invoke__">len</span>();
    <span class="hljs-keyword">for</span> (idx, val) <span class="hljs-keyword">in</span> input.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">rev</span>().<span class="hljs-title function_ invoke__">enumerate</span>() {
        <span class="hljs-keyword">if</span> &#x26;zero!=val
        {
            fz_idx = fz_idx - idx;
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-title function_ invoke__">Ok</span>(input[<span class="hljs-number">0</span>..fz_idx].<span class="hljs-title function_ invoke__">to_vec</span>())
}

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> tests {
    <span class="hljs-meta">#[test]</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">it_works</span>() {}
}
</code></pre>
<h3>Java 调用接口，注意包名和 lib.rs 的一致</h3>
<pre><code class="hljs language-java"><span class="hljs-keyword">package</span> com.doopp.common.util; <span class="hljs-comment">// 注意包名</span>

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JniUtil</span> {

    <span class="hljs-keyword">static</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">osName</span> <span class="hljs-operator">=</span> System.getProperties().getProperty(<span class="hljs-string">"os.name"</span>);
        <span class="hljs-comment">// other linux</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">nativeLibrary</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/jni_lib/libjniutil.so"</span>;
        <span class="hljs-comment">// win</span>
        <span class="hljs-keyword">if</span> (osName.contains(<span class="hljs-string">"Win"</span>)) {
            nativeLibrary = <span class="hljs-string">"/jni_lib/jniutil.dll"</span>;
        }
        <span class="hljs-comment">// mac</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (osName.contains(<span class="hljs-string">"Mac"</span>)) {
            nativeLibrary = <span class="hljs-string">"/jni_lib/libjniutil.dylib"</span>;
        }
        <span class="hljs-keyword">try</span> {
            NativeUtil.loadLibraryFromJar(nativeLibrary);
        }
        <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">dpDec</span><span class="hljs-params">(String encText)</span>;
}
</code></pre>
<h3>编译 libjniutil.dylib 并拷贝在 /resources/jni_lib 目录下</h3>
<pre><code class="hljs language-bash">$ cargo build
   Compiling libc v0.2.126
   Compiling memchr v2.5.0
   Compiling unicode-width v0.1.9
   Compiling bytes v1.2.0
   Compiling cfg-if v1.0.0
   Compiling cesu8 v1.1.0
   Compiling ansi_term v0.12.1
   Compiling thiserror v1.0.31
   Compiling <span class="hljs-built_in">log</span> v0.4.17
   Compiling textwrap v0.11.0
   Compiling jni-sys v0.3.0
   Compiling rustc-serialize v0.3.24
   Compiling bitflags v1.3.2
   Compiling vec_map v0.8.2
   Compiling strsim v0.8.0
   Compiling <span class="hljs-built_in">base64</span> v0.13.0
   Compiling hex v0.4.3
   Compiling rand v0.4.6
   Compiling atty v0.2.14
   Compiling <span class="hljs-keyword">time</span> v0.1.44
   Compiling clap v2.34.0
   Compiling combine v4.6.4
   Compiling rand v0.3.23
   Compiling rust-crypto v0.2.36
   Compiling jni v0.19.0
   Compiling jniutil v0.2.1 (/Users/develop/Project/rust-jni-lib)
   Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword">in</span> 17.05s
</code></pre></div><div class="mt-12 pt-6 border-t border-[var(--color-border)]"></div><footer class="mt-8 pt-4 border-t border-[var(--color-border)]"><a class="text-sm text-[var(--color-link)] hover:underline" href="/">← 返回</a></footer></article><!--$--><!--/$--></main><footer class="border-t border-[var(--color-border)] py-6"><div class="max-w-2xl mx-auto px-5 text-xs text-[var(--color-text-tertiary)]">© <!-- -->2026<!-- --> koocyton</div></footer><script src="/_next/static/chunks/465f799faf41e6df.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[22016,[\"/_next/static/chunks/7c92e96509cd355e.js\",\"/_next/static/chunks/eb3523e826d36cf6.js\"],\"\"]\n3:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n4:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n8:I[68027,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n:HL[\"/_next/static/chunks/9988c12a819fa1cb.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xzX2-1_SXXW-pE78bnzy_\",\"c\":[\"\",\"posts\",\"8.rust-jni\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"8.rust-jni\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/9988c12a819fa1cb.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/7c92e96509cd355e.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"children\":[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col antialiased\",\"children\":[[\"$\",\"header\",null,{\"className\":\"border-b border-[var(--color-border)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 h-12 flex items-center justify-between\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"font-mono text-sm font-semibold text-[var(--color-text)] hover:text-[var(--color-link)] transition-colors\",\"children\":\"一洼绿地\"}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-5\",\"children\":[[[\"$\",\"$L2\",\"/\",{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"文章\"}],[\"$\",\"$L2\",\"/archives\",{\"href\":\"/archives\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"归档\"}],[\"$\",\"$L2\",\"/tags\",{\"href\":\"/tags\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"标签\"}],[\"$\",\"$L2\",\"/about\",{\"href\":\"/about\",\"className\":\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors\",\"children\":\"关于\"}]],[\"$\",\"a\",null,{\"href\":\"https://github.com/koocyton\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-[var(--color-text-tertiary)] hover:text-[var(--color-text)] transition-colors\",\"children\":[\"$\",\"svg\",null,{\"className\":\"w-4 h-4\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 py-20 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-mono text-4xl font-semibold text-[var(--color-text)] mb-2\",\"children\":\"404\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-[var(--color-text-tertiary)] mb-6\",\"children\":\"页面不存在\"}],[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-link)] hover:underline\",\"children\":\"← 返回首页\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t border-[var(--color-border)] py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-5 text-xs text-[var(--color-text-tertiary)]\",\"children\":[\"© \",2026,\" koocyton\"]}]}]]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/eb3523e826d36cf6.js\",\"async\":true,\"nonce\":\"$undefined\"}]],\"$L6\"]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$L7\",false]],\"m\":\"$undefined\",\"G\":[\"$8\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"OutletBoundary\"]\na:\"$Sreact.suspense\"\nc:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"ViewportBoundary\"]\ne:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"MetadataBoundary\"]\n6:[\"$\",\"$L9\",null,{\"children\":[\"$\",\"$a\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@b\"}]}]\n7:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Le\",null,{\"children\":[\"$\",\"$a\",null,{\"name\":\"Next.Metadata\",\"children\":\"$Lf\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"10:T42b8,"])</script><script>self.__next_f.push([1,"\u003ch3\u003e目标\u003c/h3\u003e\n\u003cp\u003e在配置 Java 项目时，配制参数通过 AES 来加密，但反编译 class，很容易拿到秘钥，\nRust 开发 JNI 提供给 java 接口，是一个相对安全的方法(不是绝对安全)。\u003c/p\u003e\n\u003ch3\u003e配置 Cargo.toml\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e[package]\nname = \u003cspan class=\"hljs-string\"\u003e\"jniutil\"\u003c/span\u003e\nversion = \u003cspan class=\"hljs-string\"\u003e\"0.2.1\"\u003c/span\u003e\nauthors = [\u003cspan class=\"hljs-string\"\u003e\"koocyton \u0026#x3C;koocyton@gmail.com\u003e\"\u003c/span\u003e]\nedition = \u003cspan class=\"hljs-string\"\u003e\"2021\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\u003c/span\u003e\n\n[dependencies]\njni = \u003cspan class=\"hljs-string\"\u003e\"0.19.0\"\u003c/span\u003e\nrust-crypto = \u003cspan class=\"hljs-string\"\u003e\"0.2\"\u003c/span\u003e\nclap = \u003cspan class=\"hljs-string\"\u003e\"2.33\"\u003c/span\u003e\nhex = \u003cspan class=\"hljs-string\"\u003e\"0.4\"\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003ebase64\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"0.13.0\"\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# reqwest = { version = \"0.11\", features = [\"json\"] }\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# tokio = { version = \"1.0\", features = [\"full\"] }\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# futures = { version = \"0.3.*\" }\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# async-std = { version = \"1\", features = [\"attributes\", \"tokio1\"] }\u003c/span\u003e\n\n[lib]\ncrate_type = [\u003cspan class=\"hljs-string\"\u003e\"cdylib\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e代码 /src/lib.rs\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-rust\"\u003e\u003cspan class=\"hljs-comment\"\u003e// This is the interface to the JVM that we'll\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// call the majority of our methods on.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e jni::JNIEnv;\n\n\u003cspan class=\"hljs-comment\"\u003e// These objects are what you should use as arguments to your native function.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// They carry extra lifetime information to prevent them escaping this context\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// and getting used after being GC'd.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e jni::objects::{JClass, JString};\n\n\u003cspan class=\"hljs-comment\"\u003e// This is just a pointer. We'll be returning it from our function.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// We can't return one of the objects with lifetime information because the\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// lifetime checker won't let us.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e jni::sys::jstring;\n\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e std::error::Error;\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e crypto::aes::KeySize::KeySize128;\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e crypto::blockmodes::PkcsPadding;\n\u003cspan class=\"hljs-keyword\"\u003euse\u003c/span\u003e crypto::buffer::{RefReadBuffer, RefWriteBuffer};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e DP_CBC_KEY: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e    = \u003cspan class=\"hljs-string\"\u003e\"1111111111111111\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e DP_CBC_OFFSET: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"1111111111111111\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 注意包名 com_doopp_common_util_JniUtil\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#[no_mangle]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epub\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextern\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"system\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eJava_com_doopp_common_util_JniUtil_dpEnc\u003c/span\u003e(\n    env: JNIEnv,\n    \u003cspan class=\"hljs-comment\"\u003e// this is the class that owns our\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// static method. Not going to be\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// used, but still needs to have\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// an argument slot\u003c/span\u003e\n    _class: JClass,\n    input: JString,\n) \u003cspan class=\"hljs-punctuation\"\u003e-\u003e\u003c/span\u003e jstring {\n    \u003cspan class=\"hljs-comment\"\u003e// First, we have to get the string out of java. Check out the `strings`\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// module for more info on how this works.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003einput\u003c/span\u003e: \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e = env\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eget_string\u003c/span\u003e(input)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eexpect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Couldn't get java string!\"\u003c/span\u003e)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003einto\u003c/span\u003e();\n    \u003cspan class=\"hljs-comment\"\u003e// Then we have to create a new java string to return. Again, more info\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// in the `strings` module.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eenc_str\u003c/span\u003e: \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e = \u003cspan class=\"hljs-title function_ invoke__\"\u003eencrypt\u003c/span\u003e(DP_CBC_KEY, DP_CBC_OFFSET, input.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_str\u003c/span\u003e()).\u003cspan class=\"hljs-title function_ invoke__\"\u003eunwrap\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoutput\u003c/span\u003e = env\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003enew_string\u003c/span\u003e(enc_str)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eexpect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Couldn't get encrypt string!\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// Finally, extract the raw pointer to return.\u003c/span\u003e\n    output.\u003cspan class=\"hljs-title function_ invoke__\"\u003einto_inner\u003c/span\u003e()\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 注意包名 com_doopp_common_util_JniUtil\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#[no_mangle]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epub\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextern\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"system\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eJava_com_doopp_common_util_JniUtil_dpDec\u003c/span\u003e(\n    env: JNIEnv,\n    \u003cspan class=\"hljs-comment\"\u003e// this is the class that owns our\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// static method. Not going to be\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// used, but still needs to have\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// an argument slot\u003c/span\u003e\n    _class: JClass,\n    input: JString,\n) \u003cspan class=\"hljs-punctuation\"\u003e-\u003e\u003c/span\u003e jstring {\n    \u003cspan class=\"hljs-comment\"\u003e// First, we have to get the string out of java. Check out the `strings`\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// module for more info on how this works.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003einput\u003c/span\u003e: \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e = env\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eget_string\u003c/span\u003e(input)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eexpect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Couldn't get java string!\"\u003c/span\u003e)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003einto\u003c/span\u003e();\n    \u003cspan class=\"hljs-comment\"\u003e// Then we have to create a new java string to return. Again, more info\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// in the `strings` module.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003edec_str\u003c/span\u003e: \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e = \u003cspan class=\"hljs-title function_ invoke__\"\u003edecrypt\u003c/span\u003e(DP_CBC_KEY, DP_CBC_OFFSET, input.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_str\u003c/span\u003e()).\u003cspan class=\"hljs-title function_ invoke__\"\u003eunwrap\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eoutput\u003c/span\u003e = env\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003enew_string\u003c/span\u003e(dec_str)\n        .\u003cspan class=\"hljs-title function_ invoke__\"\u003eexpect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Couldn't get decrypt string!\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// Finally, extract the raw pointer to return.\u003c/span\u003e\n    output.\u003cspan class=\"hljs-title function_ invoke__\"\u003einto_inner\u003c/span\u003e()\n}\n\n\u003cspan class=\"hljs-comment\"\u003e/// 加密\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eencrypt\u003c/span\u003e(key: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e, iv: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e, text: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e) \u003cspan class=\"hljs-punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eResult\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e, \u003cspan class=\"hljs-type\"\u003eBox\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003edyn\u003c/span\u003e Error\u003e\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003eencrypt\u003c/span\u003e = crypto::aes::\u003cspan class=\"hljs-title function_ invoke__\"\u003ecbc_encryptor\u003c/span\u003e(\n        KeySize128,\n        key.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_bytes\u003c/span\u003e(),\n        iv.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_bytes\u003c/span\u003e(),\n        PkcsPadding\n    );\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003eread_buffer\u003c/span\u003e = RefReadBuffer::\u003cspan class=\"hljs-title function_ invoke__\"\u003enew\u003c/span\u003e(text.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_bytes\u003c/span\u003e());\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003eresult\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003evec!\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e];\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003ewrite_buffer\u003c/span\u003e = RefWriteBuffer::\u003cspan class=\"hljs-title function_ invoke__\"\u003enew\u003c/span\u003e(\u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e result);\n    encrypt.\u003cspan class=\"hljs-title function_ invoke__\"\u003eencrypt\u003c/span\u003e(\u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e read_buffer, \u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e write_buffer, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e).\u003cspan class=\"hljs-title function_ invoke__\"\u003eunwrap\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eenc_str\u003c/span\u003e = base64::\u003cspan class=\"hljs-title function_ invoke__\"\u003eencode_config\u003c/span\u003e(\u003cspan class=\"hljs-title function_ invoke__\"\u003etrim\u003c/span\u003e(\u0026#x26;result)?, base64::STANDARD);\n    \u003cspan class=\"hljs-title function_ invoke__\"\u003eOk\u003c/span\u003e(enc_str)\n}\n\n\u003cspan class=\"hljs-comment\"\u003e/// 解密\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edecrypt\u003c/span\u003e(key: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e, iv: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e, input: \u0026#x26;\u003cspan class=\"hljs-type\"\u003estr\u003c/span\u003e) \u003cspan class=\"hljs-punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eResult\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e, \u003cspan class=\"hljs-type\"\u003eBox\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003edyn\u003c/span\u003e Error\u003e\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003edecrypt\u003c/span\u003e = crypto::aes::\u003cspan class=\"hljs-title function_ invoke__\"\u003ecbc_decryptor\u003c/span\u003e(\n        KeySize128,\n        key.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_bytes\u003c/span\u003e(),\n        iv.\u003cspan class=\"hljs-title function_ invoke__\"\u003eas_bytes\u003c/span\u003e(),\n        PkcsPadding\n    );\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003ebase_text\u003c/span\u003e = base64::\u003cspan class=\"hljs-title function_ invoke__\"\u003edecode_config\u003c/span\u003e(input, base64::STANDARD)?;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003eread_buffer\u003c/span\u003e = RefReadBuffer::\u003cspan class=\"hljs-title function_ invoke__\"\u003enew\u003c/span\u003e(\u0026#x26;base_text);\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003eresult\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003evec!\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; input.\u003cspan class=\"hljs-title function_ invoke__\"\u003elen\u003c/span\u003e()];\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003ewrite_buffer\u003c/span\u003e = RefWriteBuffer::\u003cspan class=\"hljs-title function_ invoke__\"\u003enew\u003c/span\u003e(\u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e result);\n    decrypt.\u003cspan class=\"hljs-title function_ invoke__\"\u003edecrypt\u003c/span\u003e(\u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e read_buffer, \u0026#x26;\u003cspan class=\"hljs-keyword\"\u003emut\u003c/span\u003e write_buffer, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e).\u003cspan class=\"hljs-title function_ invoke__\"\u003eunwrap\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003edec_str\u003c/span\u003e = \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e::\u003cspan class=\"hljs-title function_ invoke__\"\u003efrom_utf8\u003c/span\u003e(\u003cspan class=\"hljs-title function_ invoke__\"\u003etrim\u003c/span\u003e(\u0026#x26;result)?)?;\n    \u003cspan class=\"hljs-title function_ invoke__\"\u003eOk\u003c/span\u003e(dec_str)\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003etrim\u003c/span\u003e(input: \u0026#x26;\u003cspan class=\"hljs-type\"\u003eVec\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eu8\u003c/span\u003e\u003e)  \u003cspan class=\"hljs-punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eResult\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eVec\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eu8\u003c/span\u003e\u003e, \u003cspan class=\"hljs-type\"\u003eBox\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003edyn\u003c/span\u003e Error\u003e\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003ezero\u003c/span\u003e : \u003cspan class=\"hljs-type\"\u003eu8\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003emut \u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003efz_idx\u003c/span\u003e = input.\u003cspan class=\"hljs-title function_ invoke__\"\u003elen\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (idx, val) \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e input.\u003cspan class=\"hljs-title function_ invoke__\"\u003eiter\u003c/span\u003e().\u003cspan class=\"hljs-title function_ invoke__\"\u003erev\u003c/span\u003e().\u003cspan class=\"hljs-title function_ invoke__\"\u003eenumerate\u003c/span\u003e() {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u0026#x26;zero!=val\n        {\n            fz_idx = fz_idx - idx;\n            \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n        }\n    }\n    \u003cspan class=\"hljs-title function_ invoke__\"\u003eOk\u003c/span\u003e(input[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e..fz_idx].\u003cspan class=\"hljs-title function_ invoke__\"\u003eto_vec\u003c/span\u003e())\n}\n\n\u003cspan class=\"hljs-meta\"\u003e#[cfg(test)]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003emod\u003c/span\u003e tests {\n    \u003cspan class=\"hljs-meta\"\u003e#[test]\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eit_works\u003c/span\u003e() {}\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eJava 调用接口，注意包名和 lib.rs 的一致\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-java\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e com.doopp.common.util; \u003cspan class=\"hljs-comment\"\u003e// 注意包名\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e java.io.IOException;\n\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJniUtil\u003c/span\u003e {\n\n    \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e {\n        \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003eosName\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e System.getProperties().getProperty(\u003cspan class=\"hljs-string\"\u003e\"os.name\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-comment\"\u003e// other linux\u003c/span\u003e\n        \u003cspan class=\"hljs-type\"\u003eString\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003enativeLibrary\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/jni_lib/libjniutil.so\"\u003c/span\u003e;\n        \u003cspan class=\"hljs-comment\"\u003e// win\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (osName.contains(\u003cspan class=\"hljs-string\"\u003e\"Win\"\u003c/span\u003e)) {\n            nativeLibrary = \u003cspan class=\"hljs-string\"\u003e\"/jni_lib/jniutil.dll\"\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-comment\"\u003e// mac\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (osName.contains(\u003cspan class=\"hljs-string\"\u003e\"Mac\"\u003c/span\u003e)) {\n            nativeLibrary = \u003cspan class=\"hljs-string\"\u003e\"/jni_lib/libjniutil.dylib\"\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n            NativeUtil.loadLibraryFromJar(nativeLibrary);\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (IOException e) {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRuntimeException\u003c/span\u003e(e);\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enative\u003c/span\u003e String \u003cspan class=\"hljs-title function_\"\u003edpDec\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String encText)\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e编译 libjniutil.dylib 并拷贝在 /resources/jni_lib 目录下\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ cargo build\n   Compiling libc v0.2.126\n   Compiling memchr v2.5.0\n   Compiling unicode-width v0.1.9\n   Compiling bytes v1.2.0\n   Compiling cfg-if v1.0.0\n   Compiling cesu8 v1.1.0\n   Compiling ansi_term v0.12.1\n   Compiling thiserror v1.0.31\n   Compiling \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e v0.4.17\n   Compiling textwrap v0.11.0\n   Compiling jni-sys v0.3.0\n   Compiling rustc-serialize v0.3.24\n   Compiling bitflags v1.3.2\n   Compiling vec_map v0.8.2\n   Compiling strsim v0.8.0\n   Compiling \u003cspan class=\"hljs-built_in\"\u003ebase64\u003c/span\u003e v0.13.0\n   Compiling hex v0.4.3\n   Compiling rand v0.4.6\n   Compiling atty v0.2.14\n   Compiling \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e v0.1.44\n   Compiling clap v2.34.0\n   Compiling combine v4.6.4\n   Compiling rand v0.3.23\n   Compiling rust-crypto v0.2.36\n   Compiling jni v0.19.0\n   Compiling jniutil v0.2.1 (/Users/develop/Project/rust-jni-lib)\n   Finished dev [unoptimized + debuginfo] target(s) \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 17.05s\n\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"className\":\"max-w-2xl mx-auto px-5 py-10\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-mono text-xl font-semibold text-[var(--color-text)] leading-tight\",\"children\":\"Rust 通过 JNI 提供加密解密接口\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3 mt-2 text-xs text-[var(--color-text-tertiary)] font-mono\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2023-01-08\",\"children\":\"2023-01-08\"}],[\"$\",\"span\",null,{\"children\":\"·\"}],[\"$\",\"span\",null,{\"children\":\"5 min read\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-1.5 mt-3\",\"children\":[[\"$\",\"$L2\",\"rust\",{\"href\":\"/tags/rust\",\"className\":\"text-xs font-mono text-[var(--color-text-tertiary)] hover:text-[var(--color-link)] transition-colors\",\"children\":[\"#\",\"rust\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"prose\",\"dangerouslySetInnerHTML\":{\"__html\":\"$10\"}}],\"$L11\",\"$L12\"]}]\n"])</script><script>self.__next_f.push([1,"13:I[31175,[\"/_next/static/chunks/7c92e96509cd355e.js\",\"/_next/static/chunks/eb3523e826d36cf6.js\"],\"default\"]\n11:[\"$\",\"$L13\",null,{}]\n12:[\"$\",\"footer\",null,{\"className\":\"mt-8 pt-4 border-t border-[var(--color-border)]\",\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"className\":\"text-sm text-[var(--color-link)] hover:underline\",\"children\":\"← 返回\"}]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"14:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"IconMark\"]\nb:null\nf:[[\"$\",\"title\",\"0\",{\"children\":\"Rust 通过 JNI 提供加密解密接口 - 一洼绿地\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Rust 通过 JNI 提供加密解密接口\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"javascript java php emacs spring linux flutter\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/img/avatar/favicon.png\"}],[\"$\",\"$L14\",\"4\",{}]]\n"])</script></body></html>